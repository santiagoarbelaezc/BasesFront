nuevos cambios y actualizaciones

Preguntas

CREATE SEQUENCE PREGUNTA_SEQ START WITH 1 INCREMENT BY 1 NOCACHE;

-- PROCEDIMIENTO: Insertar una pregunta
CREATE OR REPLACE PROCEDURE INSERTAR_PREGUNTA (
    P_TEXTO     IN VARCHAR2,
    P_EXAMEN_ID IN NUMBER,
    P_ID_OUT    OUT NUMBER
) AS
BEGIN
    SELECT PREGUNTA_SEQ.NEXTVAL INTO P_ID_OUT FROM dual;

    INSERT INTO Pregunta (pregunta_id, texto, examen_id)
    VALUES (P_ID_OUT, P_TEXTO, P_EXAMEN_ID);
END;
/

-- PROCEDIMIENTO: Actualizar una pregunta
CREATE OR REPLACE PROCEDURE ACTUALIZAR_PREGUNTA (
    P_ID        IN NUMBER,
    P_TEXTO     IN VARCHAR2,
    P_EXAMEN_ID IN NUMBER
) AS
BEGIN
    UPDATE Pregunta
    SET texto = P_TEXTO,
        examen_id = P_EXAMEN_ID
    WHERE pregunta_id = P_ID;
END;
/

-- PROCEDIMIENTO: Eliminar una pregunta
CREATE OR REPLACE PROCEDURE ELIMINAR_PREGUNTA (
    P_ID IN NUMBER
) AS
BEGIN
    DELETE FROM Pregunta
    WHERE pregunta_id = P_ID;
END;
/

-- PROCEDIMIENTO: Obtener todas las preguntas (puedes llamarlo desde una función o refactorizar según API)
CREATE OR REPLACE PROCEDURE OBTENER_PREGUNTAS (
    CURSOR_OUT OUT SYS_REFCURSOR
) AS
BEGIN
    OPEN CURSOR_OUT FOR
    SELECT * FROM Pregunta;
END;
/

-- SECUENCIA
CREATE SEQUENCE RESPUESTA_SEQ START WITH 1 INCREMENT BY 1 NOCACHE;

-- INSERTAR RESPUESTA
CREATE OR REPLACE PROCEDURE INSERTAR_RESPUESTA (
    P_TEXTO        IN VARCHAR2,
    P_ESCORRECTO   IN NUMBER,
    P_PREGUNTA_ID  IN NUMBER,
    P_ID_OUT       OUT NUMBER
) AS
BEGIN
    SELECT RESPUESTA_SEQ.NEXTVAL INTO P_ID_OUT FROM dual;

    INSERT INTO Respuesta (respuesta_id, texto, esCorrecto, pregunta_id)
    VALUES (P_ID_OUT, P_TEXTO, P_ESCORRECTO, P_PREGUNTA_ID);
END;
/

-- ACTUALIZAR RESPUESTA
CREATE OR REPLACE PROCEDURE ACTUALIZAR_RESPUESTA (
    P_ID           IN NUMBER,
    P_TEXTO        IN VARCHAR2,
    P_ESCORRECTO   IN NUMBER,
    P_PREGUNTA_ID  IN NUMBER
) AS
BEGIN
    UPDATE Respuesta
    SET texto = P_TEXTO,
        esCorrecto = P_ESCORRECTO,
        pregunta_id = P_PREGUNTA_ID
    WHERE respuesta_id = P_ID;
END;
/

-- ELIMINAR RESPUESTA
CREATE OR REPLACE PROCEDURE ELIMINAR_RESPUESTA (
    P_ID IN NUMBER
) AS
BEGIN
    DELETE FROM Respuesta WHERE respuesta_id = P_ID;
END;
/

-- FUNCION: VALIDAR EXISTENCIA
CREATE OR REPLACE FUNCTION EXISTE_RESPUESTA (
    P_ID IN NUMBER
) RETURN NUMBER AS
    V_COUNT NUMBER;
BEGIN
    SELECT COUNT(*) INTO V_COUNT FROM Respuesta WHERE respuesta_id = P_ID;
    RETURN V_COUNT;
END;
/

-- FUNCION: OBTENER TEXTO DE RESPUESTA
CREATE OR REPLACE FUNCTION OBTENER_TEXTO_RESPUESTA (
    P_ID IN NUMBER
) RETURN VARCHAR2 AS
    V_TEXTO VARCHAR2(500);
BEGIN
    SELECT texto INTO V_TEXTO FROM Respuesta WHERE respuesta_id = P_ID;
    RETURN V_TEXTO;
END;
/

-- SECUENCIA para ID
CREATE SEQUENCE SUBPREGUNTA_SEQ START WITH 1 INCREMENT BY 1 NOCACHE;

-- INSERTAR
CREATE OR REPLACE PROCEDURE INSERTAR_SUBPREGUNTA (
    P_TEXTO        IN VARCHAR2,
    P_PORCENTAJE   IN NUMBER,
    P_PREGUNTA_ID  IN NUMBER,
    P_ID_OUT       OUT NUMBER
) AS
BEGIN
    SELECT SUBPREGUNTA_SEQ.NEXTVAL INTO P_ID_OUT FROM dual;

    INSERT INTO SubPregunta (sub_pregunta_id, texto, porcentaje, pregunta_id)
    VALUES (P_ID_OUT, P_TEXTO, P_PORCENTAJE, P_PREGUNTA_ID);
END;
/

-- ACTUALIZAR
CREATE OR REPLACE PROCEDURE ACTUALIZAR_SUBPREGUNTA (
    P_ID           IN NUMBER,
    P_TEXTO        IN VARCHAR2,
    P_PORCENTAJE   IN NUMBER,
    P_PREGUNTA_ID  IN NUMBER
) AS
BEGIN
    UPDATE SubPregunta
    SET texto = P_TEXTO,
        porcentaje = P_PORCENTAJE,
        pregunta_id = P_PREGUNTA_ID
    WHERE sub_pregunta_id = P_ID;
END;
/

-- ELIMINAR
CREATE OR REPLACE PROCEDURE ELIMINAR_SUBPREGUNTA (
    P_ID IN NUMBER
) AS
BEGIN
    DELETE FROM SubPregunta WHERE sub_pregunta_id = P_ID;
END;
/

-- VALIDAR EXISTENCIA
CREATE OR REPLACE FUNCTION EXISTE_SUBPREGUNTA (
    P_ID IN NUMBER
) RETURN NUMBER AS
    V_COUNT NUMBER;
BEGIN
    SELECT COUNT(*) INTO V_COUNT FROM SubPregunta WHERE sub_pregunta_id = P_ID;
    RETURN V_COUNT;
END;
/

-- OBTENER TEXTO
CREATE OR REPLACE FUNCTION OBTENER_TEXTO_SUBPREGUNTA (
    P_ID IN NUMBER
) RETURN VARCHAR2 AS
    V_TEXTO VARCHAR2(500);
BEGIN
    SELECT texto INTO V_TEXTO FROM SubPregunta WHERE sub_pregunta_id = P_ID;
    RETURN V_TEXTO;
END;
/
