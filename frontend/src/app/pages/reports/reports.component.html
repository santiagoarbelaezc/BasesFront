<app-navbar></app-navbar>

<div class="main-container">

  <section class="contenedor-titulo-usuarios">
    <h1 id="titulo-gestion-usuarios">Reportes Acad√©micos</h1>
  </section>

  <!-- Pesta√±as -->
  <nav class="tabs-container">
    <button class="tab-btn" [class.active]="tabActiva === 'examenes'" (click)="tabActiva = 'examenes'">1Ô∏è‚É£ Ex√°menes Presentados</button>
    <button class="tab-btn" [class.active]="tabActiva === 'estadisticas'" (click)="tabActiva = 'estadisticas'">2Ô∏è‚É£ Estad√≠sticas por Pregunta</button>
    <button class="tab-btn" [class.active]="tabActiva === 'resumen'" (click)="tabActiva = 'resumen'">3Ô∏è‚É£ Resumen del Curso</button>
    <button class="tab-btn" [class.active]="tabActiva === 'notas'" (click)="tabActiva = 'notas'">4Ô∏è‚É£ Notas por Curso</button>
  </nav>

  <section class="tab-content">

    <!-- 1Ô∏è‚É£ Ex√°menes Presentados -->
    <div *ngIf="tabActiva === 'examenes'">
      <h3>Listado de Ex√°menes Presentados</h3>

      <!-- Filtro de examen -->
      <div style="margin-bottom: 15px;">
        <label for="filtroExamen">Filtrar por examen:</label>
        <select id="filtroExamen" [(ngModel)]="examenSeleccionadoId" (change)="actualizarExamenesFiltrados()">
          <option [ngValue]="null" disabled>-- Selecciona un examen --</option>
          <option *ngFor="let ex of listaExamenesUnicos" [ngValue]="ex">
            {{ ex }}
          </option>
        </select>
      </div>

      <!-- Bot√≥n para exportar PDF -->
      <div style="margin: 20px 0;">
        <button (click)="generarPDF()" class="btn-update">üì• Descargar informe PDF</button>
      </div>

      <!-- Contenedor para captura PDF -->
      <div id="reporteExamenes">
        <table class="user-table">
          <thead>
            <tr>
              <th>Estudiante</th>
              <th>Examen</th>
              <th>Fecha</th>
              <th>Puntaje</th>
              <th>Duraci√≥n</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let examen of examenesFiltrados">
              <td>{{ examen.estudiante }}</td>
              <td>{{ examen.examen }}</td>
              <td>{{ examen.fecha | date:'shortDate' }}</td>
              <td>{{ examen.puntaje }}%</td>
              <td>{{ examen.tiempo }}</td>
            </tr>
          </tbody>
        </table>

        <!-- Gr√°fico -->
        <div style="max-width: 600px; margin-top: 30px;">
          <canvas baseChart
                  [data]="graficoExamenes"
                  [type]="'bar'"
                  [options]="{ responsive: true }">
          </canvas>
        </div>
      </div>
    </div>

    <!-- 2Ô∏è‚É£ Estad√≠sticas por Pregunta -->
    <div *ngIf="tabActiva === 'estadisticas'">
      <h3>Estad√≠sticas por Pregunta</h3>
      <label for="examenId">ID del Examen:</label>
      <input id="examenId" [(ngModel)]="examenIdSeleccionado" placeholder="Ingrese ID" />
      <button (click)="cargarEstadisticas()">Buscar</button>

      <table *ngIf="estadisticasPregunta.length > 0" class="user-table" style="margin-top: 20px;">
        <thead>
          <tr>
            <th>Pregunta</th>
            <th>Respondidas</th>
            <th>Correctas</th>
            <th>Incorrectas</th>
            <th>% Aciertos</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of estadisticasPregunta">
            <td>{{ item.pregunta }}</td>
            <td>{{ item.vecesRespondida }}</td>
            <td>{{ item.correctas }}</td>
            <td>{{ item.incorrectas }}</td>
            <td>{{ item.porcentajeCorrectas }}%</td>
          </tr>
        </tbody>
      </table>

      <!-- Gr√°fico -->
      <div *ngIf="estadisticasPregunta.length > 0" style="max-width: 600px; margin-top: 30px;">
        <canvas baseChart
                [data]="graficoEstadisticas"
                [type]="'doughnut'"
                [options]="{ responsive: true, plugins: { legend: { position: 'bottom' } } }">
        </canvas>
      </div>
    </div>

    <!-- 3Ô∏è‚É£ Resumen del Curso -->
    <!-- 3Ô∏è‚É£ Resumen del Curso -->
<div *ngIf="tabActiva === 'resumen'">
  <h3>Resumen del Curso</h3>

  <!-- Filtro por ID del curso -->
  <label for="cursoResumenId">ID del Curso:</label>
  <input id="cursoResumenId" [(ngModel)]="cursoIdResumen" placeholder="Ingrese ID" />
  <button (click)="cargarResumenCurso()">Consultar</button>

  <!-- Bot√≥n para exportar PDF -->
  <div style="margin: 20px 0;">
    <button (click)="generarPDFResumen()" class="btn-update">üì• Descargar resumen PDF</button>
  </div>

  <!-- Contenido del resumen -->
  <div id="reporteResumenCurso" *ngIf="resumenCurso">
    <div class="resumen-card-container">
      <div class="resumen-card">Curso: {{ resumenCurso.CURSO }}</div>
      <div class="resumen-card">Grupo: {{ resumenCurso.GRUPO }}</div>
      <div class="resumen-card">Promedio: {{ resumenCurso.PROMEDIO }}%</div>
      <div class="resumen-card">M√≠nima: {{ resumenCurso.MINIMA }}%</div>
      <div class="resumen-card">M√°xima: {{ resumenCurso.MAXIMA }}%</div>
      <div class="resumen-card">Aprobados: {{ resumenCurso.APROBADOS }}</div>
      <div class="resumen-card">Reprobados: {{ resumenCurso.REPROBADOS }}</div>
    </div>

    <!-- Gr√°fico -->
    <div style="max-width: 400px; margin-top: 30px;">
      <canvas baseChart
              [data]="graficoResumenCurso"
              [type]="'bar'"
              [options]="{ responsive: true }">
      </canvas>
    </div>
  </div>
</div>

    <!-- 4Ô∏è‚É£ Notas por Curso -->
    <div *ngIf="tabActiva === 'notas'">
      <h3>Notas por Curso</h3>
      <label for="cursoNotasId">ID del Curso:</label>
      <input id="cursoNotasId" [(ngModel)]="cursoIdNotas" placeholder="Ingrese ID" />
      <button (click)="cargarNotasCurso()">Consultar</button>

      <table *ngIf="notasCurso.length > 0" class="user-table" style="margin-top: 20px;">
        <thead>
          <tr>
            <th>Estudiante</th>
            <th>Grupo</th>
            <th>Examen</th>
            <th>Nota</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let nota of notasCurso">
            <td>{{ nota.ESTUDIANTE }}</td>
            <td>{{ nota.GRUPO }}</td>
            <td>{{ nota.EXAMEN }}</td>
            <td>{{ nota.NOTA }}%</td>
          </tr>
        </tbody>
      </table>
    </div>

  </section>
</div>