<app-navbar></app-navbar>

<div class="login-container">
  <div class="login-box">
    <img src="assets/BasesIcon.png" alt="Logo" class="logo">

    <form (ngSubmit)="onRegister(registerForm)" #registerForm="ngForm" novalidate>

      <!-- Campo Nombre -->
      <div class="input-group">
        <input
          type="text"
          id="nombre"
          name="nombre"
          required
          [(ngModel)]="nombre"
          placeholder=" ">
        <label for="nombre">Nombre</label>
      </div>

      <!-- Campo Apellido -->
      <div class="input-group">
        <input
          type="text"
          id="apellido"
          name="apellido"
          required
          [(ngModel)]="apellido"
          placeholder=" ">
        <label for="apellido">Apellido</label>
      </div>

      <!-- Campo Correo -->
      <div class="input-group">
        <input
          type="email"
          id="correo"
          name="correo"
          required
          [(ngModel)]="correo"
          placeholder=" ">
        <label for="correo">Correo Electrónico</label>
      </div>

      <!-- Campo Contraseña -->
      <div class="input-group">
        <input
          type="password"
          id="password"
          name="password"
          required
          minlength="6"
          [(ngModel)]="password"
          placeholder=" ">
        <label for="password">Contraseña</label>
      </div>

      <!-- Confirmar Contraseña -->
      <div class="input-group">
        <input
          type="password"
          id="confirmPassword"
          name="confirmPassword"
          required
          [(ngModel)]="confirmPassword"
          placeholder=" ">
        <label for="confirmPassword">Confirmar Contraseña</label>
      </div>

      <!-- Selección de Rol -->
      <div class="input-group">
        <select
          id="rol"
          name="rolSeleccionado"
          required
          [(ngModel)]="rolSeleccionado"
          class="select-box"
          [disabled]="cargandoRoles">
          <option [ngValue]="null" disabled>
            {{ cargandoRoles ? 'Cargando roles...' : 'Seleccione un rol' }}
          </option>
          <option *ngFor="let rol of rolesDisponibles" [ngValue]="rol.ROL_ID">
            {{ rol.NOMBRE }}
          </option>
        </select>
        <label for="rol">Rol</label>
        <div *ngIf="errorCargaRoles" class="error-message">
          Error al cargar roles. Intente recargar la página.
        </div>
      </div>

      <!-- Mensajes de estado -->
      <div *ngIf="errorRegistro" class="error-message">
        {{ errorRegistro }}
      </div>
      <div *ngIf="registroExitoso" class="success-message">
        ¡Registro exitoso! Redirigiendo...
      </div>

      <!-- Botón de Registro -->
      <button type="submit" class="btn-login" [disabled]="isSubmitting">
        {{ isSubmitting ? 'Creando...' : 'Crear Usuario' }}
      </button>
    </form>
  </div>


  <!-- Sección de listado de usuarios -->
  <div *ngIf="usuariosRegistrados.length > 0" class="user-list-container">
    <h3>Usuarios Registrados</h3>

    <div *ngIf="cargandoUsuarios" class="loading">
      <i class="fas fa-spinner fa-spin"></i> Cargando lista de usuarios...
    </div>

    <div *ngIf="errorCargaUsuarios" class="error">
      <i class="fas fa-exclamation-triangle"></i> Error al cargar la lista de usuarios
    </div>

    <div class="table-responsive">
      <table class="user-table">
        <thead>
        <tr>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>Correo</th>
          <th>Rol</th>
          <th>Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let usuario of usuariosRegistrados">
          
          <td>{{ usuario.nombre || 'No especificado' }}</td>
          <td>{{ usuario.apellido || 'No especificado' }}</td>
          <td>{{ usuario.correo || 'No especificado' }}</td>
          <td>{{ obtenerNombreRol(usuario.rol_id) }}</td>
          <td class="actions-cell">
            <button (click)="editarUsuario(usuario)" class="btn-edit">
              <i class="fas fa-edit"></i> Editar
            </button>
            <button (click)="eliminarUsuario(usuario)" class="btn-delete">
              <i class="fas fa-trash-alt"></i> Eliminar
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>


</div>
